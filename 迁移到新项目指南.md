# 迁移到新项目指南

如果在现有项目中配置iOS Widget Extension遇到困难，我们可以考虑将代码迁移到新创建的项目中。以下是迁移步骤：

## 1. 准备新项目

我们已经创建了一个新的Flutter项目：`weather_new`。这个项目已经包含了基本的iOS和Android配置。

## 2. 迁移代码文件

将以下文件从旧项目复制到新项目：

### Flutter代码
```bash
# 复制lib目录下的所有文件
cp -r /Users/leoobai/jiwu-project/app/weather/lib/* /Users/leoobai/jiwu-project/app/weather_new/lib/

# 复制资源文件
cp -r /Users/leoobai/jiwu-project/app/weather/assets /Users/leoobai/jiwu-project/app/weather_new/
```

### 配置文件
```bash
# 复制pubspec.yaml（保留依赖配置）
cp /Users/leoobai/jiwu-project/app/weather/pubspec.yaml /Users/leoobai/jiwu-project/app/weather_new/
```

## 3. 配置iOS Widget Extension

在新项目中添加Widget Extension：

1. 打开Xcode项目：
   ```bash
   cd /Users/leoobai/jiwu-project/app/weather_new
   open ios/Runner.xcworkspace
   ```

2. 在Xcode中，点击左上角的"File" > "New" > "Target..."
3. 在模板选择器中，选择"iOS" > "Widget Extension"
4. 点击"Next"
5. 在配置页面中：
   - Product Name: 输入 `FishingWidget`
   - Organization Identifier: 保持与主应用相同
   - Language: 选择 `Swift`
   - Include Configuration Intent: 取消勾选
   - Embed in Application: 选择 `Runner`
6. 点击"Finish"
7. 如果Xcode询问是否要激活新的scheme，点击"Activate"

## 4. 配置App Group

1. 选择新创建的FishingWidget目标
2. 点击"Signing & Capabilities"选项卡
3. 点击"+ Capability"按钮
4. 添加"App Groups"能力
5. 在App Groups下添加：`group.cn.leoobai.fishingweather`
6. 对Runner目标重复相同的步骤

## 5. 复制Widget实现文件

```bash
# 复制Widget实现文件
cp /Users/leoobai/jiwu-project/app/weather/ios/FishingWidget/FishingWidget.swift /Users/leoobai/jiwu-project/app/weather_new/ios/FishingWidget/
cp /Users/leoobai/jiwu-project/app/weather/ios/FishingWidget/FishingWidgetBundle.swift /Users/leoobai/jiwu-project/app/weather_new/ios/FishingWidget/
```

## 6. 更新Info.plist

确保FishingWidget/Info.plist包含以下键值对：
- CFBundleDisplayName: 钓鱼天气
- NSExtensionPointIdentifier: com.apple.widgetkit-extension

## 7. 安装依赖并运行

```bash
cd /Users/leoobai/jiwu-project/app/weather_new
flutter pub get
flutter run -d "iPhone 16 Pro"
```

## 8. 测试Widget

1. 在模拟器中，长按主屏幕的空白区域
2. 点击左上角的"+"按钮
3. 搜索"钓鱼天气"
4. 添加小部件到主屏幕
5. 按照测试指南进行测试